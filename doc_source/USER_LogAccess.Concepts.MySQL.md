# MySQL Database Log Files<a name="USER_LogAccess.Concepts.MySQL"></a>

You can monitor the MySQL error log, slow query log, and the general log\. The MySQL error log is generated by default; you can generate the slow query and general logs by setting parameters in your DB parameter group\. Amazon RDS rotates all of the MySQL log files; the intervals for each type are given following\. 

You can monitor the MySQL logs directly through the Amazon RDS console, Amazon RDS API, Amazon RDS CLI, or AWS SDKs\. You can also access MySQL logs by directing the logs to a database table in the main database and querying that table\. You can use the mysqlbinlog utility to download a binary log\. 

For more information about viewing, downloading, and watching file\-based database logs, see [Amazon RDS Database Log Files](USER_LogAccess.md)\.

## Accessing MySQL Error Logs<a name="USER_LogAccess.MySQL.Errorlog"></a>

The MySQL error log is written to the `mysql-error.log` file\. You can view `mysql-error.log` by using the Amazon RDS console or by retrieving the log using the Amazon RDS API, Amazon RDS CLI, or AWS SDKs\. `mysql-error.log` is flushed every 5 minutes, and its contents are appended to `mysql-error-running.log`\. The `mysql-error-running.log` file is then rotated every hour and the hourly files generated during the last 24 hours are retained\. Each log file has the hour it was generated \(in UTC\) appended to its name\. The log files also have a timestamp that helps you determine when the log entries were written\.

MySQL writes to the error log only on startup, shutdown, and when it encounters errors\. A DB instance can go hours or days without new entries being written to the error log\. If you see no recent entries, it's because the server did not encounter an error that would result in a log entry\.

## Accessing the MySQL Slow Query and General Logs<a name="USER_LogAccess.MySQL.Generallog"></a>

The MySQL slow query log and the general log can be written to a file or a database table by setting parameters in your DB parameter group\. For information about creating and modifying a DB parameter group, see [Working with DB Parameter Groups](USER_WorkingWithParamGroups.md)\. You must set these parameters before you can view the slow query log or general log in the Amazon RDS console or by using the Amazon RDS API, Amazon RDS CLI, or AWS SDKs\.

You can control MySQL logging by using the parameters in this list:

+ `slow_query_log`: To create the slow query log, set to 1\. The default is 0\.

+ `general_log`: To create the general log, set to 1\. The default is 0\.

+ `long_query_time`: To prevent fast\-running queries from being logged in the slow query log, specify a value for the shortest query execution time to be logged, in seconds\. The default is 10 seconds, the minimum is 0\. If log\_output = FILE, you can specify a floating point value that goes to microsecond resolution\. If log\_output = TABLE, you must specify an integer value with second resolution\. Only queries whose execution time exceeds the `long_query_time` value are logged\. For example, setting `long_query_time` to 0\.1 prevents any query that runs for less than 100 milliseconds from being logged\.

+ `log_queries_not_using_indexes`: To log all queries that do not use an index to the slow query log, set to 1\. The default is 0\. Queries that do not use an index are logged even if their execution time is less than the value of the `long_query_time` parameter\.

+ `log_output option`: You can specify one of the following options for the `log_output` parameter\. 

  + **TABLE** \(default\)– Write general queries to the `mysql.general_log` table, and slow queries to the `mysql.slow_log` table\. 

  + **FILE**– Write both general and slow query logs to the file system\. Log files are rotated hourly\. 

  + **NONE**– Disable logging\.

When logging is enabled, Amazon RDS rotates table logs or deletes log files at regular intervals\. This measure is a precaution to reduce the possibility of a large log file either blocking database use or affecting performance\. `FILE` and `TABLE` logging approach rotation and deletion as follows:

+ When `FILE` logging is enabled, log files are examined every hour and log files older than 24 hours are deleted\. If the remaining combined log file size after the deletion exceeds a threshold of 2 percent of a DB instance's allocated space, then the largest log files are deleted until the log file size no longer exceeds the threshold\. 

+ When `TABLE` logging is enabled, log tables are rotated every 24 hours if the space used by the table logs is more than 20 percent of the allocated storage space or the size of all logs combined is greater than 10 GB\. If the amount of space used for a DB instance is greater than 90 percent of the DB instance's allocated storage space, then the thresholds for log rotation are reduced\. Log tables are then rotated if the space used by the table logs is more than 10 percent of the allocated storage space or the size of all logs combined is greater than 5 GB\. You can subscribe to the `low_free_storage` event to be notified when log tables are rotated to free up space\. For more information, see [Using Amazon RDS Event Notification](USER_Events.md)\.

  When log tables are rotated, the current log table is copied to a backup log table and the entries in the current log table are removed\. If the backup log table already exists, then it is deleted before the current log table is copied to the backup\. You can query the backup log table if needed\. The backup log table for the `mysql.general_log` table is named `mysql.general_log_backup`\. The backup log table for the `mysql.slow_log` table is named `mysql.slow_log_backup`\.

  You can rotate the `mysql.general_log` table by calling the `mysql.rds_rotate_general_log` procedure\. You can rotate the `mysql.slow_log` table by calling the `mysql.rds_rotate_slow_log` procedure\.

  Table logs are rotated during a database version upgrade\.

To work with the logs from the Amazon RDS console, Amazon RDS API, Amazon RDS CLI, or AWS SDKs, set the `log_output` parameter to FILE\. Like the MySQL error log, these log files are rotated hourly\. The log files that were generated during the previous 24 hours are retained\.

For more information about the slow query and general logs, go to the following topics in the MySQL documentation:

+ [The Slow Query Log](http://dev.mysql.com/doc/refman/5.6/en/slow-query-log.html)

+ [The General Query Log](http://dev.mysql.com/doc/refman/5.6/en/query-log.html)

## Log File Size<a name="USER_LogAccess.MySQL.LogFileSize"></a>

The MySQL slow query log, error log, and the general log file sizes are constrained to no more than 2 percent of the allocated storage space for a DB instance\. To maintain this threshold, logs are automatically rotated every hour and log files older than 24 hours are removed\. If the combined log file size exceeds the threshold after removing old log files, then the largest log files are deleted until the log file size no longer exceeds the threshold\.

For MySQL version 5\.6\.20 and later, there is a size limit on BLOBs written to the redo log\. To account for this limit, ensure that the `innodb_log_file_size` parameter for your MySQL DB instance is 10 times larger than the largest BLOB data size found in your tables, plus the length of other variable length fields \(`VARCHAR`, `VARBINARY`, `TEXT`\) in the same tables\. For information on how to set parameter values, see [Working with DB Parameter Groups](USER_WorkingWithParamGroups.md)\. For information on the redo log BLOB size limit, go to [Changes in MySQL 5\.6\.20](http://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-20.html)\.

## Managing Table\-Based MySQL Logs<a name="Appendix.MySQL.CommonDBATasks.Logs"></a>

You can direct the general and slow query logs to tables on the DB instance by creating a DB parameter group and setting the `log_output` server parameter to `TABLE`\. General queries are then logged to the `mysql.general_log` table, and slow queries are logged to the `mysql.slow_log` table\. You can query the tables to access the log information\. Enabling this logging increases the amount of data written to the database, which can degrade performance\.

Both the general log and the slow query logs are disabled by default\. In order to enable logging to tables, you must also set the `general_log` and `slow_query_log` server parameters to `1`\.

Log tables will keep growing until the respective logging activities are turned off by resetting the appropriate parameter to `0`\. A large amount of data often accumulates over time, which can use up a considerable percentage of your allocated storage space\. Amazon RDS does not allow you to truncate the log tables, but you can move their contents\. Rotating a table saves its contents to a backup table and then creates a new empty log table\. You can manually rotate the log tables with the following command line procedures, where the command prompt is indicated by `PROMPT>`: 

```
PROMPT> CALL mysql.rds_rotate_slow_log;
PROMPT> CALL mysql.rds_rotate_general_log;
```

 To completely remove the old data and reclaim the disk space, call the appropriate procedure twice in succession\. 

## Binary Logging Format<a name="USER_LogAccess.MySQL.BinaryFormat"></a>

MySQL on Amazon RDS supports both the *row\-based* and *mixed* binary logging formats for MySQL version 5\.6 and later\. The default binary logging format is mixed\. For DB instances running MySQL versions 5\.1 and 5\.5, only mixed binary logging is supported\. For details on the different MySQL binary log formats, see [Binary Logging Formats](http://dev.mysql.com/doc/refman/5.6/en/binary-log-formats.html) in the *MySQL Reference Manual*\.

**Important**  
Setting the binary logging format to row\-based can result in very large binary log files\. Large binary log files reduce the amount of storage available for a DB instance and can increase the amount of time to perform a restore operation of a DB instance\.

To set the MySQL binary logging format:

1. Sign in to the AWS Management Console and open the Amazon RDS console at [https://console\.aws\.amazon\.com/rds/](https://console.aws.amazon.com/rds/)\.

1. Click **Parameter Groups** in the left pane\.

1. For the `default.mysql5.6` or `default.mysql5.7` DB parameter group, click the **Go to Details Page** icon\.

1. Click the **Edit Parameters** button to modify the parameters in the DB parameter group\.

1. Set the `binlog_format` parameter to the binary logging format of your choice \(**MIXED** or **ROW**\)\.

1. Click the **Save Changes** button to save the updates to the DB parameter group\.

**Important**  
Changing the `default.mysql5.6` or `default.mysql5.7` DB parameter group affects all MySQL version 5\.6 DB instances that use that parameter group\. If you want to specify different binary logging formats for different MySQL 5\.6 or 5\.7 DB instances in a region, you will need to create your own DB parameter group that identifies the different logging format and assign that DB parameter group to the intended DB instances\.

For more information on DB parameter groups, see [Working with DB Parameter Groups](USER_WorkingWithParamGroups.md)\.

## Accessing MySQL Binary Logs<a name="USER_LogAccess.MySQL.Binarylog"></a>

You can use the mysqlbinlog utility to download or stream binary logs from Amazon RDS instances running MySQL 5\.6 or later\. The binary log is downloaded to your local computer, where you can perform actions such as replaying the log using the mysql utility\. For more information about using the mysqlbinlog utility, go to [Using mysqlbinlog to Back Up Binary Log Files](http://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog-backup.html)\.

 To run the mysqlbinlog utility against an Amazon RDS instance, use the following options: 

+  Specify the `--read-from-remote-server` option\. 

+  `--host`: Specify the DNS name from the endpoint of the instance\. 

+  `--port`: Specify the port used by the instance\. 

+  `--user`: Specify a MySQL user that has been granted the replication slave permission\. 

+  `--password`: Specify the password for the user, or omit a password value so the utility will prompt you for a password\. 

+ To have the file downloaded in binary format, specify the `--raw` option\. 

+  `--result-file`: Specify the local file that will receive the raw output\. 

+ Specify the names of one or more binary log files\. To get a list of the available logs, use the SQL command SHOW BINARY LOGS\.

+ To stream the binary log files, specify the `--stop-never` option\. 

For more information about mysqlbinlog options, go to [mysqlbinlog \- Utility for Processing Binary Log Files](http://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog.html)\. 

 For example: 

For Linux, OS X, or Unix:

```
mysqlbinlog \
    --read-from-remote-server \
    --host=MySQL56Instance1.cg034hpkmmjt.region.rds.amazonaws.com \
    --port=3306  \
    --user ReplUser \
    --password \
    --raw \
    --result-file=/tmp/ \
    binlog.00098
```

For Windows:

```
mysqlbinlog ^
    --read-from-remote-server ^
    --host=MySQL56Instance1.cg034hpkmmjt.region.rds.amazonaws.com ^
    --port=3306  ^
    --user ReplUser ^
    --password ^
    --raw ^
    --result-file=/tmp/ ^
    binlog.00098
```

Amazon RDS normally purges a binary log as soon as possible, but the binary log must still be available on the instance to be accessed by mysqlbinlog\. To specify the number of hours for RDS to retain binary logs, use the `mysql.rds_set_configuration` stored procedure and specify a period with enough time for you to download the logs\. After you set the retention period, monitor storage usage for the DB instance to ensure that the retained binary logs do not take up too much storage\.

**Note**  
The `mysql.rds_set_configuration` stored procedure is only available for MySQL version 5\.6 or later\.

This example sets the retention period to 1 day:

```
call mysql.rds_set_configuration('binlog retention hours', 24);
```

To display the current setting, use the `mysql.rds_show_configuration` stored procedure: 

```
call mysql.rds_show_configuration;
```